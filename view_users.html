<!DOCTYPE html>
<html>
  <head>
    <title>View Users</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      th,
      td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }
      th {
        background-color: #f2f2f2;
        font-weight: bold;
      }
      tr:hover {
        background-color: #f9f9f9;
      }
      .error {
        color: red;
        text-align: center;
        padding: 20px;
      }
      button {
        background-color: #4caf50;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
      }
      button:hover {
        background-color: #45a049;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Database Users</h1>
      <button onclick="loadUsers()">Refresh Users</button>
      <div id="userTable"></div>
    </div>

    <script>
      const urlBase = "http://162.243.185.62/LAMPAPI";

      function loadUsers() {
        const xhr = new XMLHttpRequest();
        xhr.open("GET", urlBase + "/ViewUsers.php", true);
        xhr.setRequestHeader("Content-type", "application/json; charset=UTF-8");

        xhr.onreadystatechange = function () {
          if (this.readyState == 4 && this.status == 200) {
            try {
              const jsonObject = JSON.parse(xhr.responseText);

              if (jsonObject.error) {
                document.getElementById("userTable").innerHTML =
                  '<div class="error">Error: ' + jsonObject.error + "</div>";
                return;
              }

              displayUsers(jsonObject.users);
            } catch (err) {
              document.getElementById("userTable").innerHTML =
                '<div class="error">Error parsing response: ' +
                err.message +
                "</div>";
            }
          } else if (this.readyState == 4) {
            document.getElementById("userTable").innerHTML =
              '<div class="error">HTTP Error: ' + this.status + "</div>";
          }
        };

        xhr.send();
      }

      function displayUsers(users) {
        if (!users || users.length === 0) {
          document.getElementById("userTable").innerHTML =
            '<div class="error">No users found in database</div>';
          return;
        }

        let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Login</th>
                            <th>Password</th>
                            <th>First Name</th>
                            <th>Last Name</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

        users.forEach((user) => {
          tableHTML += `
                    <tr>
                        <td>${user.id}</td>
                        <td>${user.login}</td>
                        <td>${user.password}</td>
                        <td>${user.firstName}</td>
                        <td>${user.lastName}</td>
                    </tr>
                `;
        });

        tableHTML += "</tbody></table>";
        document.getElementById("userTable").innerHTML = tableHTML;
      }

      // Load users when page loads
      window.onload = function () {
        loadUsers();
      };
    </script>
  </body>
</html>
